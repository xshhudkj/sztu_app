# WhisperPlay音乐播放器设计方案描述

## 2. 实践内容
### 2.1 设计方案描述

#### 1）设计方案描述

##### 1. 系统架构分析

基于生成的系统功能结构图分析，WhisperPlay音乐播放器采用标准的MVVM（Model-View-ViewModel）架构模式，构建了清晰的五层架构设计。该应用包含以下功能：

**1) 音乐播放功能**：基于Media3 ExoPlayer实现高质量音频播放,支持多种播放模式（顺序/随机/循环）、拖动进度控制、后台播放.通过MediaSession与Android Automotive车载系统深度集成，支持方向盘控制和车载通知。

**2) 语音控制功能**：集成百度语音SDK，支持语音唤醒和语音识别。可实现播放控制、音乐搜索、音量调节等语音指令，并提供TTS语音反馈。

**3) 在线搜索功能**：支持歌曲、专辑、歌手、歌单的多维度搜索。配备搜索建议、热门搜索词和搜索历史管理功能。

**4) 用户管理功能**：支持游客登录、手机验证码登录和二维码登录。提供用户信息管理、个人歌单创建编辑、收藏管理、播放历史记录和偏好设置。

**5) 缓存管理功能**：通过SmartCacheManager实现自适应音乐缓存策略，支持音频文件、数据和图片缓存，配备音乐预加载机制和存储空间管理。

**6) 个性化设置功能**：提供主题切换（深色/浅色模式）、播放背景模糊效果、歌词高亮显示和通知管理等个性化配置。

##### 2. 功能流程分析

基于生成的各个功能程序流程图，按照以下格式描述每个流程：

**语音控制流程**：初始化BaiduSpeechManager并检查权限，启动VoiceControlService监听唤醒词。检测到"小聆"或"轻聆"后暂停音乐，进行语音识别和语义解析，根据命令类型执行播放控制、搜索或音量调节，最后通过TTS反馈并恢复音乐播放。

**音乐播放流程**：初始化MusicService和ExoPlayer，通过PlayerController判断播放类型。FirstPlayOptimizer优化播放请求，SmartCacheManager检查缓存，ExoPlayer执行音频解码渲染，PlayingActivity更新界面，播放状态同步到车载系统。

**用户中心流程**：检查登录状态，未登录则跳转LoginActivity进行身份认证。登录成功后UserService获取用户数据，加载个人歌单、收藏和播放历史。支持歌单创建编辑、播放操作和偏好设置，数据保存到Room数据库和SharedPreferences。

**搜索功能流程**：初始化SearchFragment显示搜索界面，支持热门词、历史记录和关键词输入。经过防抖处理后通过SearchApi网络调用，解析结果按类型分类显示，支持播放、查看详情和收藏操作。

**应用启动流程**：SplashActivity执行系统初始化，检查登录状态后进入MainActivity或LoginActivity。支持三种登录方式，验证成功后保存登录状态，初始化各功能模块并加载用户数据。
